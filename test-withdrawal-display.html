<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdrawal Display Test</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body style="background: #0a0a0a; padding: 20px;">
    <h2 style="color: #00ffff; font-family: 'Press Start 2P', monospace; font-size: 12px; margin-bottom: 20px;">WITHDRAWAL DISPLAY TEST</h2>
    
    <div class="withdrawal-history" style="max-width: 400px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4>WITHDRAWAL HISTORY</h4>
            <button class="pixel-btn refresh-btn" style="font-size: 6px; padding: 4px 8px;">â†»</button>
        </div>
        <div id="withdrawalHistoryList" class="withdrawal-list">
            <!-- Test withdrawal items will be inserted here -->
        </div>
    </div>

    <script>
        // Test data with different withdrawal statuses
        const testWithdrawals = [
            {
                id: 1,
                amount: 1000,
                status: 'completed',
                transaction_hash: '5vJ9QJ1RZFWHxKjjKcGjJd8vG3WmU4qGxVb2nFhQpLzY8tRwXeNfBcDvAaSsEeFf',
                phantom_wallet_address: '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRwJ4CsQU',
                created_at: '2024-01-10T15:30:00Z'
            },
            {
                id: 2,
                amount: 2500,
                status: 'sent',
                transaction_hash: null,
                phantom_wallet_address: '9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtCWWM',
                created_at: '2024-01-10T14:15:00Z'
            },
            {
                id: 3,
                amount: 500,
                status: 'failed',
                transaction_hash: null,
                phantom_wallet_address: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
                created_at: '2024-01-10T13:00:00Z'
            }
        ];

        // Function to display withdrawals (copied from game.js)
        function displayWithdrawalHistory(withdrawals) {
            console.log('[DEBUG] Displaying withdrawal history');
            console.log('[DEBUG] Withdrawals data:', withdrawals);
            const historyList = document.getElementById('withdrawalHistoryList');
            
            if (!withdrawals || withdrawals.length === 0) {
                console.log('[DEBUG] No withdrawals found, showing default message');
                historyList.innerHTML = '<div class="no-withdrawals">No withdrawals yet</div>';
                return;
            }
            
            console.log(`[DEBUG] Found ${withdrawals.length} withdrawals`);
            historyList.innerHTML = '';
            
            withdrawals.forEach((withdrawal, index) => {
                console.log(`[DEBUG] Processing withdrawal ${index + 1}:`, withdrawal);
                const item = document.createElement('div');
                item.className = `withdrawal-item ${withdrawal.status}`;
                
                const amount = document.createElement('div');
                amount.className = 'withdrawal-amount';
                amount.textContent = `${withdrawal.amount.toLocaleString()} TOKENS`;
                
                const date = document.createElement('div');
                date.className = 'withdrawal-date';
                const withdrawalDate = new Date(withdrawal.created_at);
                date.textContent = withdrawalDate.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const details = document.createElement('div');
                details.className = 'withdrawal-details';
                
                const status = document.createElement('span');
                status.className = `withdrawal-status ${withdrawal.status}`;
                status.textContent = withdrawal.status;
                
                details.appendChild(status);
                
                console.log(`[DEBUG] Transaction hash for withdrawal ${index + 1}:`, withdrawal.transaction_hash);
                if (withdrawal.transaction_hash) {
                    console.log(`[DEBUG] Creating Solscan link for transaction: ${withdrawal.transaction_hash}`);
                    
                    // Add only Solscan button (no transaction hash text)
                    const solscanBtn = document.createElement('a');
                    solscanBtn.className = 'solscan-btn';
                    solscanBtn.href = `https://solscan.io/tx/${withdrawal.transaction_hash}`;
                    solscanBtn.target = '_blank';
                    solscanBtn.rel = 'noopener noreferrer';
                    solscanBtn.textContent = 'VIEW TX';
                    details.appendChild(solscanBtn);
                    console.log(`[DEBUG] Solscan button added for withdrawal ${index + 1}`);
                } else {
                    console.log(`[DEBUG] No transaction hash found for withdrawal ${index + 1}`);
                }
                
                const wallet = document.createElement('div');
                wallet.className = 'withdrawal-wallet';
                const walletAddr = withdrawal.phantom_wallet_address;
                wallet.textContent = `TO: ${walletAddr.substring(0, 4)}...${walletAddr.substring(walletAddr.length - 4)}`;
                
                item.appendChild(amount);
                item.appendChild(date);
                item.appendChild(wallet);
                item.appendChild(details);
                
                historyList.appendChild(item);
                console.log(`[DEBUG] Withdrawal ${index + 1} added to DOM`);
            });
            
            console.log('[DEBUG] All withdrawals processed and displayed');
        }

        // Test the display function
        displayWithdrawalHistory(testWithdrawals);
    </script>
</body>
</html>
